extends base

block content
  main.main
    div.login-form
      h2.heading-secondary.ma-bt-lg Create your account
      form.form.form--signup
        div.form__group
          label.form__label(for='name') Your name
          input#name.form__input(type='text', placeholder='John Doe', required)
        div.form__group
          label.form__label(for='email') Email address
          input#email.form__input(type='email', placeholder='you@example.com', required)
        div.form__group
          label.form__label(for='password') Password
          input#password.form__input(type='password', placeholder='••••••••', minlength='8', required)
        div.form__group.ma-bt-md
          label.form__label(for='passwordConfirm') Confirm password
          input#passwordConfirm.form__input(type='password', placeholder='••••••••', minlength='8', required)
        div.form__group
          button.btn.btn--green.btn--small(type='submit') Sign up

  script.
    (function(){
      const form = document.querySelector('.form--signup');
      if (!form) return;
      form.addEventListener('submit', async function(e){
        e.preventDefault();
        const name = document.getElementById('name').value;
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const passwordConfirm = document.getElementById('passwordConfirm').value;
        try {
          const res = await fetch('/api/v1/users/signup', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            credentials: 'same-origin',
            body: JSON.stringify({ name, email, password, passwordConfirm })
          });
          const data = await res.json();
          if (!res.ok || data.status !== 'success') {
            const msg = (data && data.message) ? data.message : 'Signup failed';
            throw new Error(msg);
          }
          alert('Account created! Redirecting...');
          window.location.assign('/');
        } catch(err) {
          alert('Signup failed: ' + err.message);
        }
      });
    })();


